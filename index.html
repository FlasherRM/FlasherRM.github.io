<!DOCTYPE html>
<html>
<head>
    <title>Speech Recognition</title>
    <script>
        let recognition = new window.webkitSpeechRecognition();
        recognition.continuous = true;
        recognition.lang = "uk-UA";
        recognition.interimResults = true;

        let recognizing = false;
        let ignoreEnd = false;
        let finalTranscript = "";

        recognition.onstart = function() {
            recognizing = true;
            console.log("Speech recognition service started");
        };

        recognition.onerror = function(event) {
            console.error("Speech recognition error: ", event.error);
        };

        recognition.onend = function() {
            recognizing = false;
            if (ignoreEnd) {
                return;
            }
            console.log("Speech recognition service ended");
        };

        recognition.onresult = function(event) {
            let interimTranscript = "";
            for (let i = event.resultIndex; i < event.results.length; ++i) {
                let transcript = event.results[i][0].transcript;
                if (event.results[i].isFinal) {
                    finalTranscript += transcript;
                    console.log(`api request ${transcript}`)
                } else {
                    interimTranscript += transcript;
                }
            }
            console.log("Final transcript: ", finalTranscript);
            console.log("Interim transcript: ", interimTranscript);

            let lastSpeak;
            if (!finalTranscript && interimTranscript && Date.now() - lastSpeak > 2000) {
                console.log("Sending request to API...");
                lastSpeak = Date.now(); // Update the last speak time
                // Call your API function here and pass the interimTranscript as a parameter
            }
        };

        function startRecognition() {
            if (recognizing) {
                recognition.stop();
                return;
            }
            finalTranscript = "";
            recognition.start();
            console.log("Speech recognition service started");
        }
    </script>
</head>
<body>
<button onclick="startRecognition()">Start/Stop Recognition</button>
</body>
</html>